# Hello World for Gen AI â€“ Template Pipeline

The `hello_gen_ai` template pipeline shows a basic step with built-in features.

## Files

This template pipeline adds the following files to your repository:

- `config/pipeline_hello_gen_ai.yml`: Creates base pipeline with the following steps:
  - `hello_gen_ai` (`steps/hello_gen_ai.py`): Example step of using OpenAI
- `config/config_hello-gen-ai.json`: configuration parameters for the pipeline
- `requirements_hello_gen_ai.txt`: package requirements for the pipeline
- `utils/hello_gen_ai/azure_openai_client.py`: Class with Azure OpenAI client
- `utils/hello_gen_ai/base_genai_step.py`: File with step class with already built in openAI client

## Configuration Parameters

The `config_hello-gen-ai.json` file contains the following keys:
- `gen_ai`, with the following subkeys:
  - `genai_proxy`: GenAI platform proxy
  - `cognitive_services`: Set of OpenAI or GenAI platform APIs to interact with
  - `open_api_version`: Particular release of Open API
  - `headers`: Additional information to be sent along with the request to the GenAI platform
    - `userid`: @pg.com address of a person who has access to the GenAI platform
    - `project-name`: Project name should match one from the itaccess group created for your project
  - `temperature`: A parameter that controls randomness of texts generated by a chat model
  - `chat_engine`: OpenAI chat model
  - `embedding_engine`: OpenAI embedding model

## Usage

**Important** Open all the steps and files created with the template, and modify them based on your needs, before you attempt to run the pipeline.

### Install requirements

After importing this hello_gen_ai pipeline, find the relative path to requirements_hello_gen_ai.txt and install all the necessary dependencies:

```sh
pip install -r <RELATIVE_PATH>/requirements_hello_gen_ai.txt
```

### Parameters

- `system_message`: Guidance for Chat on appropriate conduct
- `user_message`: Your message

#### Example:
- `system_message`: You are a person who welcomes others. Your only task is to greet the person you just met nicely.  
- `user_message`: My name is Michal

## Secrets
If you want to run the `hello_gen_ai` template pipeline locally using your pg account, skip this section and jump to the next one on how to grant [access to the GenAI platform](#access-to-the-genai-platform).

For running the `hello_gen_ai` template pipeline locally or on your AML platform using service principal credentials, some additional secret configuration is required. If you have created your project using AI Provisioner, you should have your service principal credentials (AML-APP-SP-ID and AML-APP-SP-SECRET) stored in an appropriate Azure keyvault. If not, upload the service principal credentials to the keyvault.

To be able to run the `hello_gen_ai` template pipeline locally using the service principal, the following secrets need to be added to secrets.json in your config module.
```sh
{
  "AML-APP-SP-ID": "service principal id",
  "AML-APP-SP-SECRET": "service principal secret",
  "tenant-id": "azure tenant id"
}
```
To be able to run the `hello_gen_ai` template pipeline on AML, upload the values in secrets.json to the Azure keyvault.

## Access to the GenAI Platform

In order to take full advantage of Generative AI capabilities and services, a required access to the GenAI platform is needed. See [how-to get your access to GenAI](https://developerportal.pg.com/docs/default/Component/genAI-Platform/access/).

### Extra Configuration Needed for AML

1. Private endpoint needs to be created between AML and AKS (in which the GenAI platform is deployed) 
2. Your Service Principal has to be added to the GenAI Platform as a user

Reach out to the [Azure platform team](https://teams.microsoft.com/l/channel/19%3AszpkFR6LflPwP-210tConedwY4OHUqcS39K8vbc66FI1%40thread.tacv2/General?groupId=5e32fdcc-08a7-4230-9a91-f2b421084084&tenantId=3596192b-fdf5-4e2c-a6fa-acb706c963d8) for support on this matter, and provide them with the the name of your Azure Resource Group, as well as your Service Principal ID (you can find your Service Principal ID in your Azure Key Vault with the secret name AML-APP-SP-ID).

### Unit Testing in Your Project
When you pull your project's pipeline, you'll find the tests under the `src/<your project name>/tests/` directory. There are two main approaches to creating your own unit tests:
- Using Pyrogai Mock from the Pyrogai library
- Creating your own mock

**Approach 1: Using Pyrogai Mock**

This is the recommended method for most cases.
For documentation, refer to: [Pyrogai Mock Documentation](https://developerportal.pg.com/docs/default/Component/PyrogAI/test_mock_step/)
To see implementation examples, you can pull the `ml_iris` or `ml_skeleton` pipelines.

**Approach 2: Creating Your Own Mock**

If you prefer this method, refer to the test examples that came with your pipeline.

To get started, pull your project's pipeline and navigate to the tests directory. Choose the approach that best suits your needs and refer to the provided examples for guidance.

### How to run example

```bash
# Run locally
aif pipeline run --pipelines hello_gen_ai --environment dev
```

```bash
# Run on AML platform
aif pipeline run --pipelines hello_gen_ai --environment dev --platform AML
```
